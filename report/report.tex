\documentclass[10pt,twocolumn,a4paper]{article}
\usepackage[latin1]{inputenc}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{tikz}
\usepackage{listings}
\usepackage[width=17.00cm]{geometry}
\usepackage{graphicx}
\graphicspath{{./images/}}
\newcommand{\argt}{\theta}



\title{\LARGE{\textbf{Proyecto 2021} \\
		
		
		
        Estadísticas\; \; \; Ciencias de la Computaci\'on\\
	
	
	
	\textbf{Orientaciones metodol\'ogicas:\\} Fase II\\}

Estudiantes David Guaty, Rodrigo Pino y Adrian Portales}

\date{}
%\renewcommand{\baselinestretch}{1.4}
\renewcommand{\labelenumi}{\alph{enumi}.}

\newtheorem{eje}{Ejercicio}
\newcommand{\sen}{\mbox{sen \hspace{0.001cm}}}
\newcommand{\cis}{\hspace{0.5mm}\mbox{cis}\hspace{0.5mm}}
\newcommand{\real}{\mathbb{R}}
\newcommand{\complex}{\mathbb{C}}




\begin{document}
\maketitle
\setcounter{page}{1}


\section*{Ejercicios}
\begin{eje}
    Realice un estudio de sus datos usando las técnicas de regresión, reducción de dimensión y de
    ANOVA.
    \begin{enumerate}
        \item Escoja las variables a las cuales les aplicara cada técnica y explique por qué.
        \item En las técnicas que lo requieran realice el análisis de los supuestos y explique si es válida la
        aplicación de la técnica en esa variable.
    \end{enumerate}

\end{eje}

\section*{Objetivos}
\begin{itemize}
		
\end{itemize}
 
\section*{Introducci\'on} 




\section*{T\'ecnicas de Regresi\'on}
\textit{(c\'odigo referente al an\'alisis de regresión lineal en lm.R)}

Por las caracter\'isticas de las variables de los datos con los que estamos trabajando, poder predecir el \textit{income} de un
individuo a partir del resto de las variables resulta de gran inter\'es. Por este motivo decidimos hacer una análisis y tratar de
obtener un modelo de regresión lineal que nos permita hacer predicciones sobre los ingresos anuales de una persona a partir de  un
grupo de datos del sujeto.  

Como primer paso antes de realizar cualquier an\'alisi con los datos se eliminaron todas aquellas entradas que pose\'ian valores
faltantes, ya que al final la muestra era bastante grande y eliminar dichos \textit{records} no representaba una p\'erdida  
considerable de los datos. De este modo evit\'abamos perturbaciones en los c\'aculos y an\'alisis posteriores.

Antes de hacer la regresión lineal nos interesaba analizar si exist\'ia alg\'un tipo de relaci\'on entre los datos ( ya sea lineal ono ). La gran
mayor\'ia de las variables son categ\'oricas y cont\'abamos con un muestra bastante grande ( alrededor de 32000 ) por lo que decidimos
hacer pruebas de Chi-Cuadrado de Independencia entre pares de variables categ\'oricas, sobre  todo \textit{income} con algunas
otras variables. En el caso de la educaci\'on y el sexo se obtuvo que las variables no eran independendientes, lo cual tiene
cierto sentido, pues se sabe que un mayor grado de educaci\'on implica mayores salarios y por el lado del sexo es bien sabido 
que en muchos lugares las mujeres suelen ser discriminadas y tienen salarios m\'as bajos en comparaci\'on con los hombres en puestos
equivalentes. Para el resto de combinaciones que se probaron con \textit{income} no se pudo obtener un resultado conciso, pues 
se emit\'ia una advertencia por parte de R que dec\'ia que los resultados pod\'ian no ser correctos.

Una vez hecho este peque\~no an\'alisis pasamos a la confecci\'on de los modelos de regresión lineal. Como hab\'iamos mencinoado
anteriormente la variable que resulta de mayor inter\'es para predecir es el \textit{income}, por lo que se intent\'o obtener un modelo
donde dicha variable fuera la dependiente. Cuando un modelo de regresión lineal se est\'a confeccionando, la opini\'on de un
experto en el campo de estudio tiene much\'isimo peso sobre la selecci\'on de las variables. Dado que no somos expertos decidimos
usar un enfoque \textit{backward}, es decir, planteamos un modelo  con todas las variables. Un punto importante a se\~nalar aqu\'
es que muchas de las variables son categ\'oricas y para poder hacer la regresión lineal sobre dicho conjunto de datos, estas pasan
por una transformaci\'on donde se convierten en variables binarias, en dependencia del nivel de cada categor\'ia. Lamentablemente 
este modelo no tuvo buenos resultados como se muestra a continuaci\'on:

\begin{lstlisting}[language=R,title= Funcion do\_anova Parte 1, breaklines=true]
Residual standard error: 0.3451 on 30086 degrees of freedom
Multiple R-squared:  0.3644,    Adjusted R-squared:  0.3629
F-statistic:   230 on 75 and 30086 DF,  p-value: < 2.2e-16
\end{lstlisting}

Como podemos apreciar el \textit{R-squared} es bastante bajo, por lo que incluso si este modelo cumpliera los supuestos no 
ser\'ia muy bueno ( est\'a muy por debajo de 0.70 ). Curiosamente el \textit{p-value} es  significativo, por lo que al menos
podemos decir que el modelo est\'a haciendo algo. Despu\'es de obtener dicho resultado, pasamos analizar los supuestos del modelo:

En el caso de la media y la suma de los errores, las mismas toman valores muy cercanos a 0. Sin embargo, al realizar el test de 
Breusch-Pagan  se obtuvo que no cumpl\'ia la homocedasticidad. Por lo que al no cumplir uno de los supuestos nuestro modelo dej\'o
de ser factible. 

El siguiente paso fue quitar variables, en dependencia de la signicaci\'on de cada una, un proceso bastante engorroso dado que
las variables categ\'oricas pasaban a convertirse en variables binarias en dependencia del nivel de cada categor\'ia. Dado que lo
anterior tambi\'en resultaba un poco complicado, en algunos pasos se decidi\'o usar un criterio intuitivo, y en ocasiones se
prob\'o elimiando una variable y despues volviendola a a\~nadir para eliminar otra en su lugar.

Siguiendo el criterio de la significaci\'on de cada variable se decidi\'o eliminar como primera variable \textit{native.country}.
El modelo resultante obtuvo el siguiente resultado:

\begin{lstlisting}[language=R,title= Funcion do\_anova Parte 1, breaklines=true]
Residual standard error: 0.3452 on 30126 degrees of freedom
Multiple R-squared:  0.3634,    Adjusted R-squared:  0.3626
F-statistic: 491.3 on 35 and 30126 DF,  p-value: < 2.2e-16
\end{lstlisting}

Como se puede apreciar el \textit{R-squred} disminuy\'o un poco, pero no de manera significativa. Aunque, por supuesto, el mismo
todav\'ia nos indicaba la presencia de un modelo bastante malo, pero quiz\'a cumpl\'ia con los supuestos. Sin embargo, pasaba lo
mismo que el modelo inicial: no se cumpl\'ia la homocedasticidad.

En este punto decidimos seguir con el proceso de eliminaci\'on de variables. La siguiente variable fue \textit{rece}. Los 
resultados fueron los siguientes:

\begin{lstlisting}[language=R,title= Funcion do\_anova Parte 1, breaklines=true]
Residual standard error: 0.3453 on 30130 degrees of freedom
Multiple R-squared:  0.363,     Adjusted R-squared:  0.3623
F-statistic: 553.8 on 31 and 30130 DF,  p-value: < 2.2e-16
\end{lstlisting}

Se puede ver que el \textit{R-squared} sigue disminuyendo, aunque no de manera significativa. Lamentablemente, este modelo tampoco
cumpl\'ia los supuestos: fallaba en el test de homocedasticidad. 

La b\'usqueda de un conjunto de variables independendientes continu\'o, pero no fuimos capaces de un encontrar un modelo \'util ( quiz\'a nuestra b\'usqueda no fue lo suficientemente exahustiva ),
pues en primer lugar la tendencia a la dismuci\'on del \textit{R-squared} segu\'ia y ya desde el principio el valor del mismo
nos indicaba que el modelo no era bueno.

Por el análisis hecho con la prueba de independencia de Chi-cuadrado, pensamos que s\'i podr\'ia ser posible encontrar un modelo para
predecir el \textit{income} de los individuos, sin embargo con los resultados obtenidos a trav\'es de la b\'usqueda del mismo a trav\'es de  regresión
lineal podemos concluir que si existe realmente dicha relaci\'on, la misma no debe ser lineal y ser\'ia necesario el uso de t\'ecnicas m\'as sofisticadas.

\section*{Reducción de dimensión} 

TODO

\section*{ANOVA}

\textit{(c\'odigo referente al an\'alisis anova en anova.R)}

En esta secci\'on se buscar\'an diferencias significativas entre grupos de una variable. 

Por ejemplo, nos podr\'iamos preguntar cual \textit{workclass} tiene mayor \textit{income}, o cual de las \textit{ocuppation} tienen un mayor promedio de edad. Estos an\'alisis nos sirvir\'ian para diferenciar caracter\'isticas entre grupos de personas.

Una de las variables m\'as importantes a analizar es el \textit{income}, ya que es la variable que se quiere predecir dados los dem\'as datos. Pero tenemos que la variable \textit{income} es categ\'orica(con categor\'ias $\le 50K$ y $ >50K$). Por lo que convertimos la variable \textit{income} a una variable num\'erica donde se le asigna el valor 1 a la categor\'ia  $\le 50K$ y el valor 2 a la categor\'ia $ >50K$. Con esta asignaci\'on es posible realizar un anova en el cual la variable dependiente sea el \textit{income}. Esto tiene sentido porque no nos interesa el significado exacto de la media de la variable num\'erica \textit{income}, sino la diferencias significativas entre las medias de los distintos grupos analizados. As\'i por ejemplo podemos analizar cual \textit{workclass} posee un mayor \textit{income}.

Para la realizaci\'on de los an\'alisis anova tomando como variable dependiente el \textit{income} se escogieron las variables: \textit{education}, \textit{ocupation}. En su mayor parte, un mayor nivel de \textit{education} se correlaciona con un mayor porcentaje de individuos con $>50k$ de \textit{income}. El salario de una persona depende fuertemente de su profesi\'on, existen profesiones que tienen un mayor porcentaje de individuos con $>50K$ de \textit{income}. La variable \textit{sex} es otro buen predictor del \textit{income}, pero la variable \textit{sex} al tener solo dos categor\'ias ser\'ia mejor realizar un an\'alisis mediante t-student y no anova, ya que solo que comparar\'ian dos medias, parecido a como se hizo en la primera fase del proyecto. 

Las variables escogidas son categ\'oricas y se puede analizar que categor\'ia presenta una diferencia significativa respecto al \textit{income}. 

Para realizar los an\'alisis anova en R, se implement\'o una funci\'on auxiliar que puede imprimir dos cosas: de cumplirse los supuestos del modelo se imprime el \textit{summary} del resultado de la funci\'on \textit{aov}, en caso de no cumplirse los supuestos se imprime el mensaje "assumptions not fulfilled", dando a entender que el modelo no funciona.

A continuaci\'on se explica por partes el c\'odigo de la funci\'on:
\begin{lstlisting}[language=R,title= Funcion do\_anova Parte 1, breaklines=true]
do_anova <- function(independent, dependent,name_of_independent, name_of_dependent){
independent <- sample(independent, 1000)
dependent <- sample(dependent, 1000)

anova_data <- data.frame(independent, dependent)
anova_data <- anova_data[order(anova_data$independent),]
plot(dependent ~ independent, data = anova_data, ylab = name_of_dependent, xlab= name_of_independent)
\end{lstlisting}

En esta parte se leen dos vectores: independent y dependent. Se toma una muestra de 1000 elementos de ambos. Se conforma un data frame y adem\'as se ordena el data frame por la variable independendiente categ\'orica, as\'i el data frame queda estructurado como fue visto en conferencia para la correcta utilizaci\'on del anova. Adem\'as, se grafican las distintas categor\'ias en un gr\'afico de caja para analizar gr\'aficamente si existen diferencias. 

\begin{lstlisting}[language=R,title= Funcion do\_anova Parte 2,  breaklines=true]
result <- aov(dependent ~ independent, data = anova_data)
res <- result$residuals
\end{lstlisting}

En esta parte se lleva a cabo el anova, se guardan en la variable \textit{res} los residuos para comprobar los supuestos.

\begin{lstlisting}[language=R,title= Funcion do\_anova Parte 3,  breaklines=true]

is_model_ok = TRUE
stest <- shapiro.test(res)
if(stest$p.value < 0.05){
	is_model_ok = FALSE
}

btest <- bartlett.test(res, anova_data$independent)
if(btest$p.value < 0.05){
	is_model_ok = FALSE
}
dtest <- dwtest(result)
if(dtest$p.value < 0.05){
	is_model_ok = FALSE
}
if(is_model_ok){
	summary(result)
}
else{
	print("assumptions not fulfilled")
}
\end{lstlisting}
En esta parte se hacen todas las pruebas para los supuestos. Si alguna prueba falla entonces no se cumplen los supuestos del modelo y se imprime el mensaje "assumptions not fulfilled". En caso de cumplirse los supuestos se imprime un resumen del anova.

\textbf{Income $\sim$ education}
\begin{lstlisting}[language=R, breaklines=true]
> do_anova(data$education, data$income, "education", "income")
[1] "residuals do not have a normal distribution"
[1] "residuals are not homogeneous"
[1] "assumptions not fulfilled"
\end{lstlisting}

Por lo que el modelo no cumple los supuestos.

\textbf{Income $\sim$ occupation}
\begin{lstlisting}[language=R, breaklines=true]
> do_anova(data$occupation, data$income, "occupation", "income")
[1] "residuals do not have a normal distribution"
[1] "assumptions not fulfilled"
\end{lstlisting}

Por lo que el modelo no cumple los supuestos.

En las variables escogidas no se cumple el modelo. Veamos otras variables.

\textbf{Income $\sim$ workclass}
\begin{lstlisting}[language=R, breaklines=true]
> do_anova(data$workclass, data$age, "workclass", "age")
[1] "residuals do not have a normal distribution"
[1] "assumptions not fulfilled"
\end{lstlisting}

Por lo que el modelo no cumple los supuestos.

\textbf{Income $\sim$ marital.status}
\begin{lstlisting}[language=R, breaklines=true]
> do_anova(data$marital.status, data$income, "marital.status", "income")
[1] "residuals do not have a normal distribution"
[1] "assumptions not fulfilled"
\end{lstlisting}

Por lo que el modelo no cumple los supuestos.

Por lo que no se puede aplicar Anova, al menos con la variable \textit{income}.

Pasemos a analizar otros pares de variables como \textit{workclass} y \textit{age}, podr\'iamos ver cual es el grupo de trabajadores con  mayor o menor edad.

\textbf{Age $\sim$ workclass}
\begin{lstlisting}[language=R, breaklines=true]
> do_anova(data$workclass, data$age, "workclass", "age")
[1] "residuals do not have a normal distribution"
[1] "assumptions not fulfilled"
\end{lstlisting}

Por lo que el modelo no cumple los supuestos.

Tratemos otro modelo con age. Seleccionamos la variable \textit{occupation}. Puede ser interesante saber la ocupaci\'on que tiene m\'as empleados de una edad mayor.

\textbf{Age $\sim$ occupation}
\begin{lstlisting}[language=R, breaklines=true]
> do_anova(data$occupation, data$age, "occupation", "age")
[1] "residuals do not have a normal distribution"
[1] "assumptions not fulfilled"

\end{lstlisting}

Por lo que el modelo no cumple los supuestos.

Tratemos de analizar si existe alguna diferencia entre el promedio de la ganancia capital entre los individuos de diferentes ocupaciones.

\textbf{capital-gain $\sim$ occupation}
\begin{lstlisting}[language=R, breaklines=true]
> do_anova(data$occupation, data$capital.gain, "occupation", "capital.gain")
[1] "residuals do not have a normal distribution"
[1] "residuals are not homogeneous"
[1] "assumptions not fulfilled"
\end{lstlisting}

Por lo que el modelo no cumple los supuestos.

Otro caso de inter\'es es saber si existe diferencia significativa entre el promedio de las horas de trabajo semanales entre los individuos de diferentes profesiones.
 
\textbf{hours-per-week $\sim$ occupation}
\begin{lstlisting}[language=R, breaklines=true]
> do_anova(data$occupation, data$hours.per.week, "occupation", "capital.gain")
[1] "residuals do not have a normal distribution"
[1] "residuals are not homogeneous"
[1] "assumptions not fulfilled"
 \end{lstlisting}
 
 Por lo que el modelo no cumple los supuestos.
 
 Para no hacer m\'as extensa la secci\'on, se mencionar\'a que tambi\'en se comprob\'o el anova con otros pares de variables. Digase: native-countre$\sim$education.num, native-countre$\sim$hours-per-week, race$\sim$hours-per-week, entre otras. En todas ellas los modelos no cumpl\'ian los supuestos. 
 
 Por lo que se puede afirmar con cierta seguridad que no se puede aplicar t\'ecnicas de anova a los datos. Al menos no se encontr\'o una forma de aplicarlas :-(. Los investigadores est\'an tristes.  

\section*{Conclusiones}


TODO

\section*{Contribuciones de cada integrante}
TODO

  
\end{document}
